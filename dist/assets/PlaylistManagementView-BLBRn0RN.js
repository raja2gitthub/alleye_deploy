import{r as b,j as e,B as d,s as o}from"./index-EZVcE4NK.js";import{V as N}from"./ViewHeader-Bz2swllQ.js";import{D as y}from"./DataTable-iWaiuJ_V.js";import{M as _}from"./Modal-Dywz6qs9.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";const v=({isOpen:p,onClose:c,playlist:s,allContent:m,currentUser:f,allOrganizations:x})=>{const[n,l]=b.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",contentIds:(s==null?void 0:s.contentIds)||[],assigned_org_ids:(s==null?void 0:s.assigned_org_ids)||[]}),u=async a=>{a.preventDefault();const r={name:n.name,description:n.description,curator_id:f.id,assigned_org_ids:n.assigned_org_ids};if(s!=null&&s.id){const{error:t}=await o.from("playlists").update(r).eq("id",s.id);if(t){alert(`Error: ${t.message}`);return}await o.from("playlist_content").delete().eq("playlist_id",s.id),n.contentIds.length>0&&await o.from("playlist_content").insert(n.contentIds.map(i=>({playlist_id:s.id,content_id:i})))}else{const{data:t,error:i}=await o.from("playlists").insert(r).select().single();if(i){alert(`Error: ${i.message}`);return}t&&n.contentIds.length>0&&await o.from("playlist_content").insert(n.contentIds.map(h=>({playlist_id:t.id,content_id:h})))}c()},g=(a,r)=>{l(t=>({...t,contentIds:r?[...t.contentIds,a]:t.contentIds.filter(i=>i!==a)}))},j=a=>{const r=Array.from(a.target.selectedOptions,t=>t.value);l(t=>({...t,assigned_org_ids:r.includes("all")?[]:r}))};return e.jsx(_,{isOpen:p,onClose:c,title:s?"Edit Playlist":"Create Playlist",size:"xl",children:e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"playlistName",className:"block text-sm font-medium text-text-main",children:"Playlist Name"}),e.jsx("input",{id:"playlistName",value:n.name,onChange:a=>l(r=>({...r,name:a.target.value})),className:"form-input",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"playlistDescription",className:"block text-sm font-medium text-text-main",children:"Description"}),e.jsx("textarea",{id:"playlistDescription",value:n.description,onChange:a=>l(r=>({...r,description:a.target.value})),className:"form-input"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-text-main",children:"Select Content"}),e.jsx("div",{className:"h-48 overflow-y-auto border border-border p-2 rounded-md bg-background",children:m.length>0?m.map(a=>e.jsxs("label",{className:"flex items-center p-2 rounded-md hover:bg-sidebar-accent cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.contentIds.includes(a.id),onChange:r=>g(a.id,r.target.checked),className:"h-4 w-4 rounded border-border text-primary focus:ring-primary",style:{backgroundColor:"var(--form-bg-color)"}}),e.jsx("span",{className:"ml-3 text-sm text-text-main",children:a.title})]},a.id)):e.jsx("p",{className:"text-sm text-text-secondary p-2",children:"No content available to add."})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"assignOrgs",className:"block text-sm font-medium text-text-main",children:"Assign to Organizations"}),e.jsxs("select",{id:"assignOrgs",multiple:!0,name:"assigned_org_ids",value:n.assigned_org_ids.length===0?["all"]:n.assigned_org_ids,onChange:j,className:"form-select h-48",children:[e.jsx("option",{value:"all",children:"All Organizations"}),x.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]}),e.jsx("p",{className:"text-xs text-text-secondary mt-1",children:"Hold Ctrl/Cmd to select multiple. 'All Organizations' overrides other selections."})]}),e.jsxs("div",{className:"flex justify-end pt-4 border-t border-border",children:[e.jsx(d,{type:"button",variant:"ghost",onClick:c,className:"mr-2",children:"Cancel"}),e.jsx(d,{type:"submit",children:"Save Playlist"})]})]})})},O=({playlists:p,setPlaylists:c,allContent:s,currentUser:m,allOrganizations:f})=>{const[x,n]=b.useState(!1),[l,u]=b.useState(null),g=(t=null)=>{u(t),n(!0)},j=()=>{u(null),n(!1)},a=async t=>{if(window.confirm("Are you sure you want to delete this playlist?")){const{error:i}=await o.from("playlist_content").delete().eq("playlist_id",t);if(i){alert(`Error clearing playlist content: ${i.message}`);return}const{error:h}=await o.from("playlists").delete().eq("id",t);h&&alert(`Error: ${h.message}`)}},r=[{key:"name",header:"Name"},{key:"description",header:"Description"},{key:"contentIds",header:"Content Count",render:t=>t.contentIds.length}];return e.jsxs("div",{className:"animate-fade-in",children:[e.jsx(N,{title:"Playlist Management",subtitle:"Curate and organize learning paths.",children:e.jsx(d,{onClick:()=>g(),children:"Create New Playlist"})}),e.jsx(y,{columns:r,data:p,renderActions:t=>e.jsxs("div",{className:"space-x-2",children:[e.jsx(d,{variant:"ghost",size:"sm",onClick:()=>g(t),children:"Edit"}),e.jsx(d,{variant:"danger",size:"sm",onClick:()=>a(t.id),children:"Delete"})]})}),x&&e.jsx(v,{isOpen:x,onClose:j,playlist:l,allContent:s,currentUser:m,allOrganizations:f})]})};export{O as default};

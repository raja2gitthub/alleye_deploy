const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PowerBiView-CJuC-ouf.js","assets/index-EZVcE4NK.js","assets/index-vep1-nmW.css","assets/ViewHeader-C_f75zHr.js","assets/Card-CUfzvBst.js","assets/ThreatIntelView-DyeL7mgi.js","assets/TeamManagementView-DUfDfHNb.js","assets/DataTable-iWaiuJ_V.js","assets/Modal-Dywz6qs9.js","assets/ContentAssignmentView-CcDGTBD5.js","assets/ActivityView-9tTWy5O-.js","assets/AnalyticsView-0ppzZcX2.js","assets/xapiLrsClient-D85D4vVW.js","assets/CategoricalChart-DwX3OCgn.js","assets/LineChart-BDE7GRgA.js","assets/ActivePoints-DLfukH-g.js","assets/ErrorBarContext-DMcmVl1c.js","assets/CartesianChart-DXJYFoJy.js","assets/getRadiusAndStrokeWidthFromDot-NW7TPI2l.js","assets/CartesianGrid-ByPxxI5E.js","assets/XAxis-Bu-EbL_O.js","assets/YAxis-DpvTBbGr.js","assets/PieChart-Qk7a3gMm.js","assets/PolarChart-DFVWZZVg.js","assets/BarChart-P8VKVkVQ.js","assets/barSelectors-C7tPt0tT.js","assets/QAView-BbKv9-3d.js","assets/FaqContent-B6x4ljev.js","assets/ProfileView-CgTTqcP5.js"])))=>i.map(i=>d[i]);
import{r as s,s as r,j as a,b as U,H as ee,N as ae,U as te,C as se,P as ne,c as ie,A as oe,Q as le,a as ce,M as re,S as de,_ as y}from"./index-EZVcE4NK.js";import{U as me}from"./UserProfileDropdown-CtIvH7Ly.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";const z=s.lazy(()=>y(()=>import("./PowerBiView-CJuC-ouf.js"),__vite__mapDeps([0,1,2,3,4]))),fe=s.lazy(()=>y(()=>import("./ThreatIntelView-DyeL7mgi.js"),__vite__mapDeps([5,1,2,4]))),_e=s.lazy(()=>y(()=>import("./TeamManagementView-DUfDfHNb.js"),__vite__mapDeps([6,1,2,7,8]))),$=s.lazy(()=>y(()=>import("./ContentAssignmentView-CcDGTBD5.js"),__vite__mapDeps([9,1,2,3,4,7,8]))),ue=s.lazy(()=>y(()=>import("./ActivityView-9tTWy5O-.js"),__vite__mapDeps([10,1,2,3,4,7,8]))),ye=s.lazy(()=>y(()=>import("./AnalyticsView-0ppzZcX2.js"),__vite__mapDeps([11,1,2,3,12,4,13,14,15,16,17,18,19,20,21,22,23,24,25,7]))),pe=s.lazy(()=>y(()=>import("./QAView-BbKv9-3d.js"),__vite__mapDeps([26,1,2,3,4,27]))),he=s.lazy(()=>y(()=>import("./ProfileView-CgTTqcP5.js"),__vite__mapDeps([28,1,2,4]))),we=({currentUser:n,organization:d,onLogout:D,theme:O,toggleTheme:Q})=>{const[f,T]=s.useState("Dashboard"),[P,w]=s.useState(!0),[N,v]=s.useState(!0),[M,S]=s.useState(!1),[_,V]=s.useState([]),[j,I]=s.useState([]),[b,L]=s.useState([]),[F,x]=s.useState([]),[A,H]=s.useState([]),[B,R]=s.useState([]),[G,q]=s.useState([]),[J,K]=s.useState([]),[k,C]=s.useState([]),[p,h]=s.useState({content:!1,playlists:!1,analytics:!1,qanda:!1,teams:!1});s.useEffect(()=>{(async()=>{if(!n.organization_id){v(!1);return}v(!0);try{const{data:m}=await r.from("profiles").select("*").eq("organization_id",n.organization_id),e=m||[];V(e);const i=e.map(u=>u.id),[l,o,c]=await Promise.all([r.from("news").select("*, author:profiles(name)").order("created_at",{ascending:!1}),r.from("teams").select("*").eq("organization_id",n.organization_id),i.length>0?r.from("user_assignments").select("*").in("user_id",i):Promise.resolve({data:[]})]);l.data&&x(l.data.map(u=>({...u,author:u.author||{name:"Unknown"}}))),o.data&&I(o.data),c.data&&C(c.data)}catch(m){console.error("Error fetching initial lead data:",m)}finally{v(!1)}})()},[n.organization_id]),s.useEffect(()=>{(async()=>{if(!n.organization_id)return;S(!0);const m=`or(assigned_org_ids.is.null,assigned_org_ids.eq.{},assigned_org_ids.cs.{${n.organization_id}})`;try{switch(f){case"Content Library":case"Playlists":if(!p.content){const{data:e}=await r.from("content").select("*").or(m);e&&L(e),h(i=>({...i,content:!0}))}if(!p.playlists){const{data:e}=await r.from("playlists").select("*, playlist_content(content_id)").or(m);if(e){const i=e.map(l=>({...l,contentIds:l.playlist_content.map(o=>o.content_id)}));H(i)}h(i=>({...i,playlists:!0}))}break;case"Analytics":if(!p.analytics){const e=_.map(o=>o.id),[i,l]=await Promise.all([e.length>0?r.from("analytics").select("*").in("user_id",e):Promise.resolve({data:[]}),r.from("cyber_training_analytics").select("*").eq("user_company",n.company)]);if(i.data&&R(i.data),l.data&&q(l.data),!p.content){const{data:o}=await r.from("content").select("*").or(m);o&&L(c=>[...c,...o.filter(u=>!c.some(Z=>Z.id===u.id))]),h(c=>({...c,content:!0}))}h(o=>({...o,analytics:!0}))}break;case"Q&A":if(!p.qanda){const{data:e}=await r.from("qanda").select("*, user:profiles(name, avatar_url), admin:profiles!answered_by(name)").or(`is_faq.eq.true,user:organization_id.eq.${n.organization_id}`).order("created_at",{ascending:!1});e&&K(e),h(i=>({...i,qanda:!0}))}break}}catch(e){console.error(`Error loading data for ${f}:`,e)}finally{S(!1)}})()},[f,n,_,p]),s.useEffect(()=>{if(!n.organization_id)return;const t=_.map(e=>e.id),m=r.channel(`lead-dashboard-realtime-${n.id}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"analytics",filter:`user_id=in.(${t.join(",")})`},e=>{const i=e.new;R(l=>[i,...l].sort((o,c)=>new Date(c.timestamp).getTime()-new Date(o.timestamp).getTime()))}).on("postgres_changes",{event:"INSERT",schema:"public",table:"cyber_training_analytics",filter:`user_company=eq.${n.company}`},e=>{const i=e.new;q(l=>[i,...l].sort((o,c)=>new Date(c.completed_at).getTime()-new Date(o.completed_at).getTime()))}).on("postgres_changes",{event:"*",schema:"public",table:"profiles",filter:`organization_id=eq.${n.organization_id}`},async()=>{const{data:e}=await r.from("profiles").select("*").eq("organization_id",n.organization_id);e&&V(e)}).on("postgres_changes",{event:"*",schema:"public",table:"teams",filter:`organization_id=eq.${n.organization_id}`},async()=>{const{data:e}=await r.from("teams").select("*").eq("organization_id",n.organization_id);e&&I(e)}).on("postgres_changes",{event:"*",schema:"public",table:"user_assignments",filter:`user_id=in.(${t.join(",")})`},async e=>{if(t.length>0){const{data:i}=await r.from("user_assignments").select("*").in("user_id",t);i&&C(i)}}).on("postgres_changes",{event:"*",schema:"public",table:"news"},async e=>{const i=async l=>{const{data:o}=await r.from("profiles").select("name").eq("id",l.author_id).single();return{...l,author:o||{name:"Unknown"}}};if(e.eventType==="INSERT"){const l=await i(e.new);x(o=>[l,...o].sort((c,u)=>new Date(u.created_at).getTime()-new Date(c.created_at).getTime()))}else if(e.eventType==="UPDATE"){const l=await i(e.new);x(o=>o.map(c=>c.id===e.new.id?l:c))}else e.eventType==="DELETE"&&x(l=>l.filter(o=>o.id!==e.old.id))}).subscribe();return()=>{r.removeChannel(m)}},[_,n.id,n.company,n.organization_id]);const g=s.useMemo(()=>_.filter(t=>t.id!==n.id),[_,n.id]),E=(d==null?void 0:d.theme_color)||"var(--secondary-color)",W=()=>{if(M&&!N)return a.jsx("div",{className:"flex h-full w-full items-center justify-center",children:a.jsxs("p",{children:["Loading ",f,"..."]})});let t=null;switch(f){case"Dashboard":t=a.jsx(z,{organization:d});break;case"Threat Intel":t=a.jsx(fe,{updates:F});break;case"Team Management":t=a.jsx(_e,{users:_,teams:j,setTeams:I,currentUser:n});break;case"Content Library":t=a.jsx($,{users:g,content:b,playlists:A,currentUser:n,teams:j,initialView:"content",userAssignments:k});break;case"Playlists":t=a.jsx($,{users:g,content:b,playlists:A,currentUser:n,teams:j,initialView:"playlists",userAssignments:k});break;case"Activity":t=a.jsx(ue,{users:g,content:b,playlists:A,userAssignments:k});break;case"Analytics":t=a.jsx(ye,{teamUsers:g,teamAnalytics:B,teamCyberAnalytics:G,allContent:b,allUsers:_,organization:d});break;case"Q&A":t=a.jsx(pe,{qandaItems:J});break;case"Profile":t=a.jsx(he,{user:n,onLogout:D});break;default:t=a.jsx(z,{organization:d})}return a.jsx(s.Suspense,{fallback:a.jsxs("div",{className:"flex h-full w-full items-center justify-center",children:["Loading ",f,"..."]}),children:t})},X=[{name:"Dashboard",icon:ee},{name:"Threat Intel",icon:ae},{name:"Team Management",icon:te},{name:"Content Library",icon:se},{name:"Playlists",icon:ne},{name:"Activity",icon:ie},{name:"Analytics",icon:oe},{name:"Q&A",icon:le},{name:"Profile",icon:ce}],Y={backgroundColor:`${E}33`,color:E};return a.jsxs("div",{className:"flex h-screen bg-background text-text-main",children:[a.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden ${P?"block":"hidden"}`,onClick:()=>w(!1)}),a.jsxs("aside",{className:`w-64 flex-shrink-0 bg-sidebar border-r border-border flex flex-col fixed inset-y-0 left-0 z-30 md:relative md:translate-x-0 transform ${P?"translate-x-0":"-translate-x-full"} transition-transform duration-300 ease-in-out`,children:[a.jsx("div",{className:"h-20 flex items-center justify-center px-4 border-b border-border",children:d!=null&&d.logo_url?a.jsx("img",{src:d.logo_url,alt:d.name,className:"h-10 max-w-full object-contain"}):a.jsx(U,{className:"text-text-main h-8"})}),a.jsx("nav",{className:"flex-1 p-4 space-y-2",children:X.map(t=>a.jsxs("button",{onClick:()=>{T(t.name),w(!1)},className:`w-full flex items-center px-3 py-2.5 text-sm font-medium rounded-lg transition-colors ${f!==t.name?"text-text-secondary hover:bg-sidebar-accent":""}`,style:f===t.name?Y:{},children:[a.jsx(t.icon,{className:"mr-3 h-5 w-5"}),a.jsx("span",{children:t.name})]},t.name))})]}),a.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[a.jsxs("header",{className:"h-20 flex-shrink-0 bg-sidebar/80 backdrop-blur-md border-b border-border flex items-center justify-between px-6 sticky top-0 z-10",children:[a.jsx("button",{onClick:()=>w(!0),className:"text-text-secondary md:hidden",children:a.jsx(re,{className:"h-6 w-6"})}),a.jsxs("div",{className:"relative hidden md:block",children:[a.jsx(de,{className:"w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-text-secondary"}),a.jsx("input",{type:"text",placeholder:"Search...",className:"form-input bg-sidebar-accent pl-10 w-64 !py-2"})]}),a.jsx(me,{user:n,onLogout:D,onProfileClick:()=>T("Profile"),theme:O,toggleTheme:Q})]}),a.jsx("main",{className:"flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto",children:N?a.jsx("div",{className:"flex h-full w-full items-center justify-center",children:a.jsx("p",{children:"Loading your dashboard..."})}):a.jsx("div",{className:"max-w-7xl mx-auto",children:W()})})]}),a.jsx("style",{children:`
                .btn-primary-themed {
                    background-color: ${E};
                    color: black;
                }
                .btn-primary-themed:hover {
                    opacity: 0.9;
                }
            `})]})};export{we as default};

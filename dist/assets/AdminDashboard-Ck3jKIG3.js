const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DashboardView-BgNL3y0I.js","assets/index-EZVcE4NK.js","assets/index-vep1-nmW.css","assets/Card-CUfzvBst.js","assets/ContentManagementView-A_EYinEA.js","assets/DataTable-iWaiuJ_V.js","assets/ViewHeader-Bz2swllQ.js","assets/Modal-Dywz6qs9.js","assets/PlaylistManagementView-BLBRn0RN.js","assets/ThreatIntelView-CGQXYzGq.js","assets/OrganizationManagementView-DOktgBKA.js","assets/UserManagementView-ChoNzXfw.js","assets/QAManagementView-Vgs25fRP.js","assets/AnalyticsView-CgEUZpkg.js","assets/xapiLrsClient-D85D4vVW.js","assets/CategoricalChart-DwX3OCgn.js","assets/LineChart-BDE7GRgA.js","assets/ActivePoints-DLfukH-g.js","assets/ErrorBarContext-DMcmVl1c.js","assets/CartesianChart-DXJYFoJy.js","assets/getRadiusAndStrokeWidthFromDot-NW7TPI2l.js","assets/CartesianGrid-ByPxxI5E.js","assets/XAxis-Bu-EbL_O.js","assets/YAxis-DpvTBbGr.js","assets/PieChart-Qk7a3gMm.js","assets/PolarChart-DFVWZZVg.js","assets/BarChart-P8VKVkVQ.js","assets/barSelectors-C7tPt0tT.js","assets/ProfileView-Dwww7c1S.js"])))=>i.map(i=>d[i]);
import{r as o,s as c,j as a,H as J,C as K,P as W,N as X,O as Z,U as ee,Q as te,A as se,a as ne,M as ae,S as ie,_ as m}from"./index-EZVcE4NK.js";import{U as oe}from"./UserProfileDropdown-CtIvH7Ly.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";const O=o.lazy(()=>m(()=>import("./DashboardView-BgNL3y0I.js"),__vite__mapDeps([0,1,2,3]))),ce=o.lazy(()=>m(()=>import("./ContentManagementView-A_EYinEA.js"),__vite__mapDeps([4,1,2,3,5,6,7]))),re=o.lazy(()=>m(()=>import("./PlaylistManagementView-BLBRn0RN.js"),__vite__mapDeps([8,1,2,6,5,7]))),le=o.lazy(()=>m(()=>import("./ThreatIntelView-CGQXYzGq.js"),__vite__mapDeps([9,1,2,6,5,7]))),de=o.lazy(()=>m(()=>import("./OrganizationManagementView-DOktgBKA.js"),__vite__mapDeps([10,1,2,6,5,7]))),fe=o.lazy(()=>m(()=>import("./UserManagementView-ChoNzXfw.js"),__vite__mapDeps([11,1,2,6,3,5,7]))),ue=o.lazy(()=>m(()=>import("./QAManagementView-Vgs25fRP.js"),__vite__mapDeps([12,1,2,6,3,7]))),me=o.lazy(()=>m(()=>import("./AnalyticsView-CgEUZpkg.js"),__vite__mapDeps([13,1,2,6,14,3,15,16,17,18,19,20,21,22,23,24,25,26,27,5]))),we=o.lazy(()=>m(()=>import("./ProfileView-Dwww7c1S.js"),__vite__mapDeps([28,1,2,3]))),be=({currentUser:u,onLogout:N,theme:U,toggleTheme:q})=>{const[b,y]=o.useState("Dashboard"),[S,v]=o.useState(!0),[D,A]=o.useState(!0),[Q,P]=o.useState(!1),[j,w]=o.useState([]),[C,p]=o.useState([]),[z,h]=o.useState([]),[M,g]=o.useState([]),[E,_]=o.useState([]),[$,R]=o.useState([]),[H,k]=o.useState([]),[Y,I]=o.useState([]),[L,T]=o.useState({userCount:0,contentCount:0,playlistCount:0,organizationCount:0}),[V,B]=o.useState(0),[d,f]=o.useState({content:!1,playlists:!1,updates:!1,organizations:!1,users:!1,qanda:!1,analytics:!1});o.useEffect(()=>{(async()=>{A(!0);const[n,e,t,s,i,l]=await Promise.all([c.from("profiles").select("id",{count:"exact",head:!0}),c.from("content").select("id",{count:"exact",head:!0}),c.from("playlists").select("id",{count:"exact",head:!0}),c.from("organizations").select("id",{count:"exact",head:!0}),c.from("news").select("*, author:profiles(name)").order("created_at",{ascending:!1}).limit(3),c.from("qanda").select("id",{count:"exact",head:!0}).is("answer",null)]);T({userCount:n.count??0,contentCount:e.count??0,playlistCount:t.count??0,organizationCount:s.count??0}),i.data&&w(i.data.map(x=>({...x,author:x.author||{name:"Unknown"}}))),B(l.count??0),A(!1)})()},[]),o.useEffect(()=>{b!=="Dashboard"&&!D&&(async()=>{switch(P(!0),b){case"Content":if(!d.content){const{data:n}=await c.from("content").select("*").order("created_at",{ascending:!1});n&&p(n),f(e=>({...e,content:!0}))}break;case"Playlists":if(!d.playlists){const{data:n}=await c.from("playlists").select("*, playlist_content(content_id)").order("created_at",{ascending:!1});if(n){const e=n.map(t=>({...t,contentIds:t.playlist_content.map(s=>s.content_id),playlist_content:void 0}));g(e)}f(e=>({...e,playlists:!0}))}if(!d.content){const{data:n}=await c.from("content").select("*").order("created_at",{ascending:!1});n&&p(n),f(e=>({...e,content:!0}))}break;case"Threat Intel":if(!d.updates){const{data:n}=await c.from("news").select("*, author:profiles(name)").order("created_at",{ascending:!1});n&&w(n.map(e=>({...e,author:e.author||{name:"Unknown"}}))),f(e=>({...e,updates:!0}))}break;case"Organizations":if(!d.organizations){const{data:n}=await c.from("organizations").select("*");n&&_(n),f(e=>({...e,organizations:!0}))}if(!d.users){const{data:n}=await c.from("profiles").select("*");n&&h(n),f(e=>({...e,users:!0}))}break;case"Users":if(!d.users){const{data:n}=await c.from("profiles").select("*");n&&h(n),f(e=>({...e,users:!0}))}if(!d.organizations){const{data:n}=await c.from("organizations").select("*");n&&_(n),f(e=>({...e,organizations:!0}))}break;case"Q&A":if(!d.qanda){const{data:n}=await c.from("qanda").select("*, user:profiles(name, avatar_url), admin:profiles!answered_by(name)").order("created_at",{ascending:!1});n&&I(n),f(e=>({...e,qanda:!0}))}break;case"Analytics":if(!d.analytics){const[n,e]=await Promise.all([c.from("analytics").select("*").order("timestamp",{ascending:!1}),c.from("cyber_training_analytics").select("*").order("completed_at",{ascending:!1})]);n.data&&R(n.data),e.data&&k(e.data),f(t=>({...t,analytics:!0}))}if(!d.content){const{data:n}=await c.from("content").select("*");n&&p(e=>[...e,...n.filter(t=>!e.some(s=>s.id===t.id))]),f(e=>({...e,content:!0}))}if(!d.organizations){const{data:n}=await c.from("organizations").select("*");n&&_(n),f(e=>({...e,organizations:!0}))}if(!d.users){const{data:n}=await c.from("profiles").select("*");n&&h(n),f(e=>({...e,users:!0}))}break}P(!1)})()},[b,D]),o.useEffect(()=>{const r=[],n=(e,t)=>{const s=c.channel(`public:${e}`).on("postgres_changes",{event:"*",schema:"public",table:e},t).subscribe();r.push(s)};return n("analytics",e=>{e.eventType==="INSERT"&&R(t=>[e.new,...t])}),n("cyber_training_analytics",e=>{e.eventType==="INSERT"&&k(t=>[e.new,...t])}),n("profiles",e=>{e.eventType==="INSERT"?h(t=>[e.new,...t]):e.eventType==="UPDATE"?h(t=>t.map(s=>s.id===e.new.id?e.new:s)):e.eventType==="DELETE"&&h(t=>t.filter(s=>s.id!==e.old.id)),T(t=>({...t,userCount:e.eventType==="INSERT"?t.userCount+1:e.eventType==="DELETE"?t.userCount-1:t.userCount}))}),n("news",async e=>{const t=async s=>{const{data:i}=await c.from("profiles").select("name").eq("id",s.author_id).single();return{...s,author:i||{name:"Unknown"}}};if(e.eventType==="INSERT"){const s=await t(e.new);w(i=>[s,...i].sort((l,x)=>new Date(x.created_at).getTime()-new Date(l.created_at).getTime()))}else if(e.eventType==="UPDATE"){const s=await t(e.new);w(i=>i.map(l=>l.id===e.new.id?s:l))}else e.eventType==="DELETE"&&w(s=>s.filter(i=>i.id!==e.old.id))}),n("content",e=>{e.eventType==="INSERT"?p(t=>[e.new,...t]):e.eventType==="UPDATE"?p(t=>t.map(s=>s.id===e.new.id?e.new:s)):e.eventType==="DELETE"&&p(t=>t.filter(s=>s.id!==e.old.id)),T(t=>({...t,contentCount:e.eventType==="INSERT"?t.contentCount+1:e.eventType==="DELETE"?t.contentCount-1:t.contentCount}))}),n("playlists",async e=>{const t=async s=>{const{data:i}=await c.from("playlist_content").select("content_id").eq("playlist_id",s.id);return{...s,contentIds:(i==null?void 0:i.map(l=>l.content_id))||[]}};if(e.eventType==="INSERT"){const s=await t(e.new);g(i=>[s,...i])}else if(e.eventType==="UPDATE"){const s=await t(e.new);g(i=>i.map(l=>l.id===e.new.id?s:l))}else e.eventType==="DELETE"&&g(s=>s.filter(i=>i.id!==e.old.id));e.eventType!=="UPDATE"&&T(s=>({...s,playlistCount:e.eventType==="INSERT"?s.playlistCount+1:e.eventType==="DELETE"?s.playlistCount-1:s.playlistCount}))}),n("organizations",e=>{e.eventType==="INSERT"?_(t=>[e.new,...t]):e.eventType==="UPDATE"?_(t=>t.map(s=>s.id===e.new.id?e.new:s)):e.eventType==="DELETE"&&_(t=>t.filter(s=>s.id!==e.old.id)),T(t=>({...t,organizationCount:e.eventType==="INSERT"?t.organizationCount+1:e.eventType==="DELETE"?t.organizationCount-1:t.organizationCount}))}),n("qanda",async e=>{const t=async s=>{const{data:i}=await c.from("profiles").select("name, avatar_url").eq("id",s.user_id).single(),{data:l}=s.answered_by?await c.from("profiles").select("name").eq("id",s.answered_by).single():{data:null};return{...s,user:i,admin:l}};if(e.eventType==="INSERT"){const s=await t(e.new);I(i=>[s,...i].sort((l,x)=>new Date(x.created_at).getTime()-new Date(l.created_at).getTime()))}else if(e.eventType==="UPDATE"){const s=await t(e.new);I(i=>i.map(l=>l.id===e.new.id?s:l))}else e.eventType==="DELETE"&&I(s=>s.filter(i=>i.id!==e.old.id))}),()=>{r.forEach(e=>c.removeChannel(e))}},[]);const F=()=>{let r=null;switch(b){case"Dashboard":r=a.jsx(O,{currentUser:u,stats:L,updates:j,setUpdates:w,pendingQandaCount:V,setActiveView:y});break;case"Content":r=a.jsx(ce,{content:C,setContent:p,currentUser:u,allOrganizations:E});break;case"Playlists":r=a.jsx(re,{playlists:M,setPlaylists:g,allContent:C,currentUser:u,allOrganizations:E});break;case"Threat Intel":r=a.jsx(le,{updates:j,setUpdates:w,currentUser:u});break;case"Organizations":r=a.jsx(de,{organizations:E,setOrganizations:_,users:z,setUsers:h});break;case"Users":r=a.jsx(fe,{users:z,setUsers:h,organizations:E,currentUser:u});break;case"Q&A":r=a.jsx(ue,{qandaItems:Y,currentUser:u});break;case"Analytics":r=a.jsx(me,{analytics:$,cyberAnalytics:H,content:C,organizations:E,users:z});break;case"Profile":r=a.jsx(we,{user:u,onLogout:N});break;default:r=a.jsx(O,{currentUser:u,stats:L,updates:j,setUpdates:w,pendingQandaCount:V,setActiveView:y})}return a.jsx(o.Suspense,{fallback:a.jsxs("div",{className:"flex h-full w-full items-center justify-center",children:["Loading ",b,"..."]}),children:r})},G=[{name:"Dashboard",icon:J},{name:"Content",icon:K},{name:"Playlists",icon:W},{name:"Threat Intel",icon:X},{name:"Organizations",icon:Z},{name:"Users",icon:ee},{name:"Q&A",icon:te},{name:"Analytics",icon:se},{name:"Profile",icon:ne}];return a.jsxs("div",{className:"flex h-screen bg-base-100 text-base-content",children:[a.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden ${S?"block":"hidden"}`,onClick:()=>v(!1)}),a.jsxs("aside",{className:`w-64 flex-shrink-0 bg-base-200 border-r border-base-300 flex flex-col fixed inset-y-0 left-0 z-30 md:relative md:translate-x-0 transform ${S?"translate-x-0":"-translate-x-full"} transition-transform duration-300 ease-in-out`,children:[a.jsx("div",{className:"h-20 flex items-center justify-center px-4 border-b border-base-300",children:a.jsx("h1",{className:"text-xl font-bold",children:"ALL EYE"})}),a.jsx("nav",{className:"flex-1 p-4 space-y-2",children:G.map(r=>a.jsxs("button",{onClick:()=>{y(r.name),v(!1)},className:`w-full flex items-center px-3 py-2.5 text-sm font-medium rounded-lg transition-colors ${b===r.name?"bg-primary/20 text-primary":"text-base-content/70 hover:bg-base-300"}`,children:[a.jsx(r.icon,{className:"mr-3 h-5 w-5"}),a.jsx("span",{children:r.name})]},r.name))})]}),a.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[a.jsxs("header",{className:"navbar bg-base-200/80 backdrop-blur-md border-b border-base-300 sticky top-0 z-10 h-20",children:[a.jsxs("div",{className:"navbar-start",children:[a.jsx("button",{onClick:()=>v(!0),className:"btn btn-ghost btn-circle md:hidden",children:a.jsx(ae,{className:"h-6 w-6"})}),a.jsxs("label",{className:"input input-bordered flex items-center gap-2 hidden md:flex",children:[a.jsx(ie,{className:"w-4 h-4 opacity-70"}),a.jsx("input",{type:"text",className:"grow",placeholder:"Search"})]})]}),a.jsx("div",{className:"navbar-end",children:a.jsx(oe,{user:u,onLogout:N,onProfileClick:()=>y("Profile"),theme:U,toggleTheme:q})})]}),a.jsx("main",{className:"flex-1 p-4 sm:p-6 lg:p-8 overflow-y-auto",children:D?a.jsx("div",{className:"flex h-full w-full items-center justify-center",children:a.jsx("span",{className:"loading loading-lg"})}):a.jsx("div",{className:"max-w-7xl mx-auto",children:Q?a.jsx("div",{className:"flex h-full w-full items-center justify-center",children:a.jsx("span",{className:"loading loading-lg"})}):F()})})]})]})};export{be as default};

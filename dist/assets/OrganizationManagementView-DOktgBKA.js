import{r as h,j as r,B as u,s as o}from"./index-EZVcE4NK.js";import{V as b}from"./ViewHeader-Bz2swllQ.js";import{D as g}from"./DataTable-iWaiuJ_V.js";import{M as v}from"./Modal-Dywz6qs9.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";const w=({isOpen:p,onClose:f,organization:s,allUsers:x})=>{const[a,d]=h.useState({name:(s==null?void 0:s.name)||"",theme_color:(s==null?void 0:s.theme_color)||"#cbdd59",logo_url:(s==null?void 0:s.logo_url)||"",powerbi_embed_url:(s==null?void 0:s.powerbi_embed_url)||""}),[i,c]=h.useState(x.filter(e=>e.organization_id===(s==null?void 0:s.id)).map(e=>e.id)),m=async e=>{e.preventDefault();const l={...a};if(s!=null&&s.id){const{data:t,error:n}=await o.from("organizations").update(l).eq("id",s.id).select().single();if(n){alert(`Error: ${n.message}`);return}t&&(await o.from("profiles").update({organization_id:null}).eq("organization_id",t.id),i.length>0&&await o.from("profiles").update({organization_id:t.id}).in("id",i))}else{const{data:t,error:n}=await o.from("organizations").insert(l).select().single();if(n){alert(`Error: ${n.message}`);return}t&&i.length>0&&await o.from("profiles").update({organization_id:t.id}).in("id",i)}f()},j=(e,l)=>{c(t=>l?[...t,e]:t.filter(n=>n!==e))},_=x.filter(e=>!e.organization_id||e.organization_id===(s==null?void 0:s.id));return r.jsx(v,{isOpen:p,onClose:f,title:s?"Edit Organization":"Add Organization",children:r.jsxs("form",{onSubmit:m,className:"space-y-4",children:[r.jsx("input",{value:a.name,onChange:e=>d(l=>({...l,name:e.target.value})),placeholder:"Organization Name",className:"form-input",required:!0}),r.jsx("input",{value:a.logo_url,onChange:e=>d(l=>({...l,logo_url:e.target.value})),placeholder:"Logo URL",className:"form-input"}),r.jsx("input",{value:a.powerbi_embed_url,onChange:e=>d(l=>({...l,powerbi_embed_url:e.target.value})),placeholder:"Power BI Embed URL",className:"form-input"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("label",{children:"Theme Color:"}),r.jsx("input",{type:"color",value:a.theme_color,onChange:e=>d(l=>({...l,theme_color:e.target.value})),className:"h-8 w-8 rounded-md"})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"font-semibold mb-2",children:"Assign Users"}),r.jsx("div",{className:"max-h-60 overflow-y-auto border border-border p-2 rounded-md",children:_.map(e=>r.jsxs("label",{className:"flex items-center p-2 rounded-md hover:bg-sidebar-accent",children:[r.jsx("input",{type:"checkbox",checked:i.includes(e.id),onChange:l=>j(e.id,l.target.checked),className:"h-4 w-4 rounded"}),r.jsxs("span",{className:"ml-3 text-text-secondary",children:[e.name," (",e.email,")"]})]},e.id))})]}),r.jsx("div",{className:"flex justify-end pt-4",children:r.jsx(u,{type:"submit",children:"Save Organization"})})]})})},M=({organizations:p,setOrganizations:f,users:s,setUsers:x})=>{const[a,d]=h.useState(!1),[i,c]=h.useState(null),m=(l=null)=>{c(l),d(!0)},j=()=>{c(null),d(!1)},_=async l=>{if(window.confirm("Are you sure? Deleting an organization will also delete its users.")){const{error:t}=await o.from("organizations").delete().eq("id",l);t&&alert(`Error: ${t.message}`)}},e=[{key:"name",header:"Name"},{key:"theme_color",header:"Theme Color",render:l=>r.jsxs("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-4 h-4 rounded-full mr-2",style:{backgroundColor:l.theme_color}}),l.theme_color]})},{key:"user_count",header:"User Count",render:l=>s.filter(t=>t.organization_id===l.id).length}];return r.jsxs("div",{className:"animate-fade-in",children:[r.jsx(b,{title:"Organization Management",subtitle:"Manage client organizations and their settings.",children:r.jsx(u,{onClick:()=>m(),children:"Add Organization"})}),r.jsx(g,{columns:e,data:p,renderActions:l=>r.jsxs("div",{className:"space-x-2",children:[r.jsx(u,{variant:"ghost",size:"sm",onClick:()=>m(l),children:"Edit"}),r.jsx(u,{variant:"danger",size:"sm",onClick:()=>_(l.id),children:"Delete"})]})}),a&&r.jsx(w,{isOpen:a,onClose:j,organization:i,allUsers:s})]})};export{M as default};

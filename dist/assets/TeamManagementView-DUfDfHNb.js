import{r as d,j as s,B as n,s as i}from"./index-EZVcE4NK.js";import{D as j}from"./DataTable-iWaiuJ_V.js";import{M as g}from"./Modal-Dywz6qs9.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";const A=({users:f,teams:o,setTeams:E,currentUser:T})=>{const[h,l]=d.useState(!1),[t,c]=d.useState(null),[x,u]=d.useState(!1),[r,p]=d.useState(null),v=[{key:"name",header:"Team Name"},{key:"members",header:"Member Count",render:e=>f.filter(a=>a.team===e.id).length}],N=[{key:"name",header:"User Name"},{key:"email",header:"Email"},{key:"team",header:"Team",render:e=>{var a;return((a=o.find(m=>m.id===e.team))==null?void 0:a.name)||"N/A"}}],y=async e=>{let a;t?{error:a}=await i.from("teams").update(e).eq("id",t.id):{error:a}=await i.from("teams").insert({...e,organization_id:T.organization_id}),a&&alert(a.message),l(!1),c(null)},b=async e=>{if(window.confirm("Are you sure you want to delete this team? All users will be unassigned from it.")){const{error:a}=await i.from("profiles").update({team:null}).eq("team",e);if(a){alert(`Error unassigning users: ${a.message}`);return}const{error:m}=await i.from("teams").delete().eq("id",e);m&&alert(`Error deleting team: ${m.message}`)}},w=async e=>{if(!r)return;const{error:a}=await i.from("profiles").update(e).eq("id",r.id);a&&alert(a.message),u(!1),p(null)};return s.jsxs("div",{className:"animate-fade-in",children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h2",{className:"text-2xl font-bold",children:"Teams"}),s.jsx(n,{onClick:()=>{c(null),l(!0)},children:"New Team"})]}),s.jsx(j,{columns:v,data:o,renderActions:e=>s.jsxs("div",{className:"space-x-2",children:[s.jsx(n,{variant:"ghost",size:"sm",onClick:()=>{c(e),l(!0)},children:"Edit"}),s.jsx(n,{variant:"danger",size:"sm",onClick:()=>b(e.id),children:"Delete"})]})})]}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Users"}),s.jsx(j,{columns:N,data:f,renderActions:e=>s.jsx(n,{variant:"ghost",size:"sm",onClick:()=>{p(e),u(!0)},children:"Edit Team"})})]})]}),h&&s.jsx(g,{isOpen:h,onClose:()=>l(!1),title:t?"Edit Team":"Create Team",children:s.jsxs("form",{onSubmit:e=>{e.preventDefault(),y({name:e.currentTarget.elements.namedItem("name").value})},children:[s.jsx("input",{name:"name",defaultValue:t==null?void 0:t.name,placeholder:"Team Name",className:"form-input",required:!0}),s.jsx("div",{className:"flex justify-end pt-4 mt-4",children:s.jsx(n,{type:"submit",children:"Save Team"})})]})}),x&&r&&s.jsx(g,{isOpen:x,onClose:()=>u(!1),title:`Assign Team for ${r.name}`,children:s.jsxs("form",{onSubmit:e=>{e.preventDefault(),w({team:e.currentTarget.elements.namedItem("team").value})},children:[s.jsxs("select",{name:"team",defaultValue:r.team,className:"form-select",children:[s.jsx("option",{value:"",children:"No Team"}),o.map(e=>s.jsx("option",{value:e.id,children:e.name},e.id))]}),s.jsx("div",{className:"flex justify-end pt-4 mt-4",children:s.jsx(n,{type:"submit",children:"Assign Team"})})]})})]})};export{A as default};

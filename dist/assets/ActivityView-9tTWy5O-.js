import{r as g,j as s,B as v}from"./index-EZVcE4NK.js";import{V as j}from"./ViewHeader-C_f75zHr.js";import{C}from"./Card-CUfzvBst.js";import{D as h}from"./DataTable-iWaiuJ_V.js";import{M as S}from"./Modal-Dywz6qs9.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";const w=({isOpen:l,onClose:u,user:a,allContent:d,allPlaylists:n,userAssignments:i})=>{if(!a)return null;const p=g.useMemo(()=>{const e=i.filter(t=>t.user_id===a.id),c=new Set(e.filter(t=>t.content_id).map(t=>t.content_id)),y=new Set(e.filter(t=>t.playlist_id).map(t=>t.playlist_id));return n.forEach(t=>{y.has(t.id)&&t.contentIds.forEach(o=>c.add(o))}),Array.from(c).map(t=>{var m;const o=d.find(x=>x.id===t);if(!o)return null;const r=(m=a.progress)==null?void 0:m[t];return{id:o.id,title:o.title,type:o.type,status:(r==null?void 0:r.status)||"not-started",score:r==null?void 0:r.score}}).filter(t=>!!t)},[a,i,d,n]),f=[{key:"title",header:"Content Title"},{key:"type",header:"Type"},{key:"status",header:"Status",render:e=>s.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full capitalize ${e.status==="completed"?"bg-green-500/20 text-green-300":e.status==="in-progress"?"bg-yellow-500/20 text-yellow-300":"bg-gray-500/20 text-gray-300"}`,children:e.status.replace("-"," ")})},{key:"score",header:"Score",render:e=>e.score!==void 0&&e.score!==null?`${e.score}%`:"N/A"}];return s.jsx(S,{isOpen:l,onClose:u,title:`Progress for ${a.name}`,size:"xl",children:s.jsx(h,{columns:f,data:p})})},E=({users:l,content:u,playlists:a,userAssignments:d})=>{const[n,i]=g.useState(null),p=g.useMemo(()=>l.map(e=>{const c=e.progress||{},y=Object.values(c).filter(r=>r.status==="completed").length,t=Object.values(c).map(r=>r.score).filter(r=>r!=null),o=t.length>0?t.reduce((r,m)=>r+m,0)/t.length:0;return{...e,id:e.id,completedCourses:y,averageScore:Math.round(o)}}),[l]),f=[{key:"name",header:"User"},{key:"points",header:"Points",render:e=>e.points||0},{key:"completedCourses",header:"Courses Completed"},{key:"averageScore",header:"Average Score",render:e=>e.averageScore?`${e.averageScore}%`:"N/A"}];return s.jsxs("div",{className:"animate-fade-in",children:[s.jsx(j,{title:"Team Activity",subtitle:"View performance metrics for your team members."}),s.jsx(C,{children:s.jsx(h,{columns:f,data:p,renderActions:e=>s.jsx(v,{variant:"ghost",size:"sm",onClick:()=>i(e),children:"View Progress"})})}),s.jsx(w,{isOpen:!!n,onClose:()=>i(null),user:n,allContent:u,allPlaylists:a,userAssignments:d})]})};export{E as default};

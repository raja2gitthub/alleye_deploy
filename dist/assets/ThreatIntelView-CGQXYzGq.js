import{r as x,e as d,j as s,B as u,s as j}from"./index-EZVcE4NK.js";import{V as b}from"./ViewHeader-Bz2swllQ.js";import{D as g}from"./DataTable-iWaiuJ_V.js";import{M as v}from"./Modal-Dywz6qs9.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";const y=({isOpen:f,onClose:c,update:e,currentUser:m})=>{const[r,l]=x.useState({title:(e==null?void 0:e.title)||"",type:(e==null?void 0:e.type)||d.HTML_ARTICLE,content:(e==null?void 0:e.content)||"",embed_url:(e==null?void 0:e.embed_url)||"",thumbnail_url:(e==null?void 0:e.thumbnail_url)||""}),h=async t=>{t.preventDefault();const a={...r,author_id:m.id};if(e!=null&&e.id){const{error:i}=await j.from("news").update(a).eq("id",e.id);i?alert(`Error: ${i.message}`):c()}else{const{error:i}=await j.from("news").insert(a);i?alert(`Error: ${i.message}`):c()}};return s.jsx(v,{isOpen:f,onClose:c,title:e?"Edit News":"Create News",children:s.jsxs("form",{onSubmit:h,className:"space-y-4",children:[s.jsx("input",{value:r.title,onChange:t=>l(a=>({...a,title:t.target.value})),placeholder:"Title",className:"form-input",required:!0}),s.jsx("select",{value:r.type,onChange:t=>l(a=>({...a,type:t.target.value})),className:"form-select",children:Object.values(d).map(t=>s.jsx("option",{value:t,children:t},t))}),r.type===d.HTML_ARTICLE&&s.jsx("textarea",{value:r.content,onChange:t=>l(a=>({...a,content:t.target.value})),placeholder:"Article content (HTML allowed)",className:"form-input",rows:10}),r.type===d.REACT_SANDBOX&&s.jsx("input",{value:r.embed_url,onChange:t=>l(a=>({...a,embed_url:t.target.value})),placeholder:"React Sandbox Embed URL",className:"form-input"}),s.jsx("input",{value:r.thumbnail_url,onChange:t=>l(a=>({...a,thumbnail_url:t.target.value})),placeholder:"Thumbnail Image URL",className:"form-input"}),s.jsx("div",{className:"flex justify-end pt-4",children:s.jsx(u,{type:"submit",children:"Save Post"})})]})})},C=({updates:f,setUpdates:c,currentUser:e})=>{const[m,r]=x.useState(!1),[l,h]=x.useState(null),t=(n=null)=>{h(n),r(!0)},a=()=>{h(null),r(!1)},i=async n=>{if(window.confirm("Are you sure you want to delete this news post?")){const{error:o}=await j.from("news").delete().eq("id",n);o&&alert(`Error: ${o.message}`)}},w=[{key:"title",header:"Title"},{key:"type",header:"Type"},{key:"created_at",header:"Published On",render:n=>new Date(n.created_at).toLocaleDateString()},{key:"author",header:"Author",render:n=>{var o;return((o=n.author)==null?void 0:o.name)||"Unknown"}}];return s.jsxs("div",{className:"animate-fade-in",children:[s.jsx(b,{title:"Threat Intel Feed",subtitle:"Manage and publish security news and articles.",children:s.jsx(u,{onClick:()=>t(),children:"New Post"})}),s.jsx(g,{columns:w,data:f,renderActions:n=>s.jsxs("div",{className:"space-x-2",children:[s.jsx(u,{variant:"ghost",size:"sm",onClick:()=>t(n),children:"Edit"}),s.jsx(u,{variant:"danger",size:"sm",onClick:()=>i(n.id),children:"Delete"})]})}),m&&s.jsx(y,{isOpen:m,onClose:a,update:l,currentUser:e})]})};export{C as default};
